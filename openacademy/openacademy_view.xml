<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!-- menu Open Academy -->
        <menuitem id="menu_root" name="Open Academy"
            web_icon="images/blackboard.png"
            web_icon_hover="images/blackboard_hover.png"/>

        <!-- menu Open Academy / Courses -->
        <record id="action_courses" model="ir.actions.act_window">
            <field name="name">Courses</field>
            <field name="res_model">openacademy.course</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_my_courses': True}</field>
        </record>
        <menuitem id="menu_courses" parent="menu_root"
            name="Courses" sequence="1" action="action_courses"/>

        <!-- menu Open Academy / Sessions -->
        <record id="action_sessions" model="ir.actions.act_window">
            <field name="name">Sessions</field>
            <field name="res_model">openacademy.session</field>
            <field name="view_mode">tree,form,calendar</field>
        </record>
        <menuitem id="menu_sessions" parent="menu_root"
            name="Sessions" sequence="2" action="action_sessions"/>

        <!-- course list view -->
        <record id="course_list_view" model="ir.ui.view">
            <field name="name">course list view</field>
            <field name="model">openacademy.course</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Courses">
                    <field name="name"/>
                    <field name="description"/>
                </tree>
            </field>
        </record>

        <!-- course search view -->
        <record id="course_search_view" model="ir.ui.view">
            <field name="name">course search view</field>
            <field name="model">openacademy.course</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search>
                    <filter name="my_courses" string="My Courses"
                        domain="[('responsible_id', '=', uid)]"/>
                    <field name="name"/>
                </search>
            </field>
        </record>

        <!-- course form view -->
        <record id="course_form_view" model="ir.ui.view">
            <field name="name">course form view</field>
            <field name="model">openacademy.course</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <field name="name"/>
                    <field name="responsible_id"/>
                    <notebook colspan="4">
                        <page string="Description">
                            <field name="description" nolabel="1"/>
                        </page>
                        <page string="Sessions">
                            <field name="session_ids" nolabel="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="start_date" />
                                </tree>
                                <form>
                                    <group colspan="2" col="2">
                                        <separator string="General" colspan="2"/>
                                        <field name="name"/>
                                        <field name="instructor_id"/>
                                    </group>
                                    <group colspan="2" col="2">
                                        <separator string="Schedule" colspan="2"/>
                                        <field name="start_date"/>
                                        <field name="duration"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <!-- session list view -->
        <record id="session_list_view" model="ir.ui.view">
            <field name="name">session list view</field>
            <field name="model">openacademy.session</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Sessions" colors="blue:duration&lt;5;red:duration&gt;15">
                    <field name="name"/>
                    <field name="course_id"/>
                    <field name="start_date"/>
                    <field name="duration" invisible="1"/>
                    <field name="taken_seats_pct" widget="progressbar"/>
                </tree>
            </field>
        </record>

        <!-- session form view -->
        <record id="session_form_view" model="ir.ui.view">
            <field name="name">session form view</field>
            <field name="model">openacademy.session</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <group colspan="2" col="2">
                        <separator string="General" colspan="2"/>
                        <!-- The attribute 'attrs' defines a dynamic attribute
                            on the field element.  In this particular case, it
                            adds readonly="1" to the field element when the
                            condition is met (state is not 'draft'.) -->
                        <field name="name"
                            attrs="{'readonly': [('state','!=','draft')]}"/>
                        <field name="course_id"
                            attrs="{'readonly': [('state','!=','draft')]}"/>
                        <field name="instructor_id"/>
                        <field name="active"
                            groups="openacademy.group_manager"/>
                    </group>
                    <group colspan="2" col="2">
                        <separator string="Schedule" colspan="2"/>
                        <field name="start_date"
                            attrs="{'readonly': [('state','!=','draft')]}"/>
                        <field name="duration"
                            attrs="{'readonly': [('state','!=','draft')]}"/>
                        <field name="seats"
                            on_change="onchange_seats(seats, attendee_ids)"/>
                        <field name="taken_seats_pct" widget="progressbar"/>
                    </group>
                    <separator string="Attendees" colspan="4"/>
                    <field name="attendee_ids" nolabel="1" colspan="4"
                        on_change="onchange_seats(seats, attendee_ids)">
                        <tree editable="bottom">
                            <field name="partner_id"/>
                        </tree>
                    </field>
                    <field name="state" widget="statusbar"/>
                    <group colspan="2">
                        <button string="Reset to Draft" icon="gtk-cancel"
                            name="signal_reset" type="workflow"
                            states="confirmed,done"/>
                        <button string="Confirm" icon="gtk-ok"
                            name="signal_confirm" type="workflow"
                            states="draft"/>
                        <button string="Done" icon="gtk-ok"
                            name="signal_done" type="workflow"
                            states="confirmed"/>
                    </group>
                </form>
            </field>
        </record>

        <!-- session calendar view -->
        <record id="session_calendar_view" model="ir.ui.view">
            <field name="name">session calendar view</field>
            <field name="model">openacademy.session</field>
            <field name="type">calendar</field>
            <field name="arch" type="xml">
                <calendar string="Session Calendar"
                    date_start="start_date" date_stop="end_date"
                    color="instructor_id">
                    <field name="name"/>
                </calendar>
            </field>
        </record>

    </data>
</openerp>
